# Debate Mate - Updated Deployment Guide

## ğŸš€ Quick Start

### 1. Install Dependencies
```bash
pnpm install
```

### 2. Set Environment Variables in Vercel

Go to **Vercel Dashboard** â†’ **Settings** â†’ **Environment Variables** and add:

```
GROK_API_KEY=xai-your-actual-api-key-here
CLAUDE_API_KEY=sk-ant-your-actual-api-key-here
```

**âš ï¸ CRITICAL:** 
- Never use placeholder values like "your-grok-api-key-here"
- API keys must start with proper prefixes (`xai-` for Grok, `sk-ant-` for Claude)
- Keys are validated server-side to prevent deployment with invalid keys

### 3. Deploy to Vercel

```bash
# Using Vercel CLI
vercel --prod

# Or push to GitHub (auto-deploys if connected)
git push origin main
```

## ğŸ”’ Security Features Implemented

### âœ… API Key Validation
- Server-side validation checks for placeholder values
- Format validation (Grok: `xai-*`, Claude: `sk-ant-*`)
- Prevents deployment with invalid/missing keys

### âœ… Input Sanitization
- DOMPurify for XSS protection
- HTML tag removal while preserving text content
- Input length limits (500 chars for arguments, 50 for names)

### âœ… Content Security Policy (CSP)
- Strict CSP headers in `vercel.json`
- `object-src 'none'` prevents plugin execution
- `upgrade-insecure-requests` enforces HTTPS
- Frame protection with `frame-ancestors 'none'`

### âœ… Rate Limiting
- Client-side: 5 requests per minute
- Stored in localStorage with automatic reset
- Prevents API abuse

### âœ… Secret Leak Prevention
- API responses scanned for sensitive patterns
- Error messages sanitized (no API keys exposed)
- Server-side logging only (never sent to client)

## ğŸ¯ New Features

### Petty Mode - Social Sharing Bar
After analysis, users see:
- **ğŸ“± Share Roast** - Web Share API (native share dialog)
- **ğŸ”— Copy Link** - Copy debate URL to clipboard
- **ğŸ“¹ TikTok** - Copy formatted text for TikTok
- **ğŸ¦ X Post** - Open Twitter/X with pre-filled tweet
- **Facebook/Twitter** - Direct share buttons via react-share

**Share Text Format:**
```
AI just destroyed [opponent] ğŸ˜‚ #PettyMode debate-mate.app
```

### Productive Mode - Export Bar
After analysis, users see:
- **ğŸ“ Notes** - Web Share API â†’ Send to Notes app
- **ğŸŸ¢ Evernote** - Deep link to Evernote (`evernote://`)
- **ğŸ¯ Notion** - Copy formatted text + attempt Notion deep link
- **ğŸ’¾ Save Local** - Download as `.txt` file

**Export Format:**
```markdown
# Debate Analysis - Productive Mode

**Participants:**
- Person 1: [argument]
- Person 2: [argument]

**Winner:** [name]
**Scores:** [X/10 vs Y/10]

**Analysis:**
[detailed analysis]

---
Generated by Debate Mate (debate-mate.app)
```

## ğŸ“¦ Dependencies Added

```json
{
  "react-share": "^4.4.1"
}
```

Install with:
```bash
pnpm install
```

## ğŸ—ï¸ Project Structure

```
debate-mate.v2/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ analyze/
â”‚       â”œâ”€â”€ grok.js          # Grok API handler (Petty Mode)
â”‚       â””â”€â”€ claude.js        # Claude API handler (Productive Mode)
â”œâ”€â”€ client/
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ SocialShareBar.jsx  # NEW: Petty Mode sharing
â”‚       â”‚   â””â”€â”€ ExportBar.jsx       # NEW: Productive Mode export
â”‚       â”œâ”€â”€ lib/
â”‚       â”‚   â”œâ”€â”€ aiService.js
â”‚       â”‚   â”œâ”€â”€ debateUtils.js
â”‚       â”‚   â””â”€â”€ security.js
â”‚       â””â”€â”€ App.jsx
â”œâ”€â”€ vercel.json              # Updated CSP headers
â””â”€â”€ package.json             # Added react-share
```

## ğŸ”§ Configuration Files

### vercel.json
- Enhanced CSP with `object-src 'none'` and `upgrade-insecure-requests`
- Security headers (X-Frame-Options, X-Content-Type-Options, etc.)
- CORS configuration for API endpoints

### API Handlers (grok.js, claude.js)
- Enhanced API key validation
- Placeholder detection
- Format validation
- Secure error handling (no key leaks)

## ğŸ§ª Testing Checklist

Before deploying:

- [ ] Environment variables set in Vercel
- [ ] API keys are valid (not placeholders)
- [ ] Petty Mode: Social bar appears after analysis
- [ ] Productive Mode: Export bar appears after analysis
- [ ] Share buttons work (test on mobile for Web Share API)
- [ ] Copy to clipboard works
- [ ] Download file works
- [ ] Rate limiting works (try 6 requests in 1 minute)
- [ ] Input validation works (try >500 chars)
- [ ] CSP headers present (check in browser DevTools)

## ğŸ› Troubleshooting

### "Service configuration error"
- Check API keys are set in Vercel environment variables
- Verify keys are not placeholders
- Ensure keys have correct format (Grok: `xai-*`, Claude: `sk-ant-*`)

### Social/Export bars not showing
- Verify `result` state is set after analysis
- Check mode is correctly set (`petty` or `productive`)
- Check browser console for errors

### Share buttons not working
- Web Share API requires HTTPS (works on Vercel)
- Some browsers don't support Web Share API (fallback to clipboard)
- Check CSP allows `navigator.share`

### Rate limit not working
- Check localStorage is enabled
- Verify `checkRateLimit()` is called before API request
- Check browser console for errors

## ğŸ“± Mobile Considerations

- Web Share API works best on mobile devices
- Deep links (Evernote, Notion) may not work on all platforms
- Clipboard API requires HTTPS (automatic on Vercel)
- Touch targets are sized appropriately (44x44px minimum)

## ğŸš€ Deployment Steps

1. **Install dependencies:**
   ```bash
   pnpm install
   ```

2. **Set environment variables in Vercel:**
   - Go to project settings
   - Add `GROK_API_KEY` and `CLAUDE_API_KEY`
   - Ensure values are real API keys (not placeholders)

3. **Deploy:**
   ```bash
   vercel --prod
   ```

4. **Verify:**
   - Check deployment logs for errors
   - Test both modes
   - Verify security headers in browser DevTools
   - Test social/export features

## ğŸ“ Notes

- Social sharing uses `react-share` library for Facebook/Twitter
- Web Share API is preferred for native sharing (mobile)
- Export features use clipboard API and file downloads
- All features gracefully degrade if APIs are unavailable

## ğŸ” Security Best Practices

1. **Never commit API keys** - Use environment variables only
2. **Rotate keys regularly** - Update in Vercel dashboard
3. **Monitor usage** - Check Vercel logs for suspicious activity
4. **Rate limit** - Already implemented client-side (5 req/min)
5. **Validate inputs** - All inputs sanitized and length-limited
6. **CSP headers** - Strict Content Security Policy enforced

---

**Ready to deploy! ğŸ‰**

